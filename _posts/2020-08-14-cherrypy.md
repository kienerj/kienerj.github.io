---
layout: post
title: Setting up CherryPy
subtitle: a minimalist python web framework
tags: [rdkit, python, cherrypy]
comments: true
---

[CherryPy](https://cherrypy.org/) is a minimalist python web framework. You may ask what "minimalist" means in the context of web frameworks? It does not offer any front-end tools and does not offer any ORM. But you can use one of your choice if you whish to do so. It's unopinionated. You can access your data directly with the according database-specific library (cx_Oracle, psycopg2,...) or combine it with SQLAlchemy. It's up to you. I really prefer it for creating simple web services that can be used over multiple applications. In this blog post I will outline how to setup CherryPy on an Ubuntu server.

## Installing CherryPy

CherryPy is available via pip or conda. Back when I started using it, the build on conda was outdated. Right now it's up to date but looking at the history I'm not sure the official maintainers regularly update the conda builds. Since this is a pure python module I suggest to stick with the official guide and install CherryPy via pip. We will use a conda environment so you will need to have anaconda or miniconda already installed.

```bash
conda create -c rdkit -n webservices python=3.7 rdkit
conda activate webservices
conda install pip
pip install cherrypy
```

We will use python 3.7 because RDKit as of now does not have an official 3.8 build available on conda and the end-goal will be to build webservices that make use of RDKit functionality. You may also install additional packages into this environment as per your needs.

## Running CherryPy applications

CherryPy ships with it's own integrated HTTP/1.1-compliant, WSGI thread-pooled Web Server which is production ready. In fact you can use it to serve any WSGI-based python web application even if not built with CherryPy framework. It can also s[erve static files](https://docs.cherrypy.org/en/latest/basics.html#static-content-serving). Depending on your needs and setup, nothing else is required. However in this section I will outline one of multiple way to run cherrypy behind Apache acting as reverse proxy. This can be useful if needing to run the CherryPy apps on an existing webserver that already has Apache installed. I would expect the steps for other web servers like nginx to be similar.

1. Install Apache

    ```bash
    sudo apt update
    sudo apt install apache2
    ```

2. Enable `mod_proxy

    ```bash
    sudo a2enmod proxy_http
    ```

3. Add Location to Apache configuration

    ```
    <Location /cherrypy-app>
    	Order allow,deny
    	allow from all
    	ProxyPass http://127.0.0.1:8080
    	ProxyPassReverse http://127.0.0.1:8080
    </Location>
    ```
    You need to adjust the location path accordingly. The port can also be changed but you must keep the chosen port in mind as it will be needed again later on.

4. 